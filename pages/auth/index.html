<!DOCTYPE html>
<html>
<head>
	<title>Auth</title>
<style>

.£fixed           {position:fixed;}
.£fixed-corners   {top:0; left:0; right:0; bottom:0;}
.£fullscreen      {width:100vw; height:100vh;}
.£visible-overlay {z-index:1000;}
.£scheme-light    {background-color:#fff; color:rgb(30,30,30);}
.£scheme-dark     {background-color:rgb(30,30,30); color:#fff;}

#user {
	width:250px;
	margin:auto;
}

#user img {
	width:80px;
}
#user h3 {
	color:#ccc;
}
#user h5 {
	color:#aaa;
}
</style>
</head>
<body>

<div id="loginPage" class="£fixed £fullscreen £fixed-corners £visible-overlay £scheme-dark">
	<button id="githubSignin">Github</button>
	<button id="googleSignin">Google</button>
</div>

<div id="user"></div>
<button id="signOut">Sign out</button>
<button id="adminButton">Clickable if admin</button>

<script src="https://www.gstatic.com/firebasejs/3.7.4/firebase.js"></script>
<script>

let getID = id => document.getElementById(id);
let DOM = (id, state) => {
	let obj = getID(id).style;
	if(state) {obj.visibility = 'visible'; obj.display = 'block'; obj.opacity = '1';}
	else {obj.visibility = 'hidden'; obj.display = 'none'; obj.opacity = '0';}}


// Initialize Firebase
var config = {
    apiKey: "AIzaSyBhEbBw2glQVPOjAWyAoSFYwrVLc-CUwCo",
    authDomain: "signinauth-713f2.firebaseapp.com",
    databaseURL: "https://signinauth-713f2.firebaseio.com",
    storageBucket: "signinauth-713f2.appspot.com",
    messagingSenderId: "156229110097"};
firebase.initializeApp(config);

const auth = firebase.auth();
var githubProvider = new firebase.auth.GithubAuthProvider();
var googleProvider = new firebase.auth.GoogleAuthProvider();


var userName, userEmail, userId, userProvider, userImg;


// GITHUB SIGN IN
getID('githubSignin').addEventListener('click', e => {
	firebase.auth().signInWithPopup(githubProvider)
	.then(function(result) {
	   	setUserData(result);
	   	updateLocalUser();
	   	displayUser(result);
	})
	.catch(function(error) {
    	console.log(error.message);
    });
});

// GOOGLE SIGN IN
getID('googleSignin').addEventListener('click', e => {
	firebase.auth().signInWithPopup(googleProvider)
	.then(function(result) {
	   	setUserData(result);
	   	updateLocalUser();
	    displayUser(result);
	})
	.catch(function(error) {
    	console.log(error.message);
    });
});

// SIGN OUT
getID('signOut').addEventListener('click', e => {
	firebase.auth().signOut()
	.then(function() {
  		console.log('Signed out.');
  	})
	.catch(function(error) {
  		console.log(error.message);
  	});
});

// DISPLAY IF AUTH
auth.onAuthStateChanged(user => {
	if (user) {DOM('loginPage', false); updateLocalUser();}
	else 	  DOM('loginPage', true);
});

//SET LOCALSTORAGE LOGIN DATA
function setUserData(result) {
	let user = result.user.providerData[0];
	localStorage.setItem('userName', user.displayName);
	localStorage.setItem('userEmail', user.email);
	localStorage.setItem('userId', user.uid);
	localStorage.setItem('userProvider', user.providerId);
	localStorage.setItem('userImg', user.photoUrl);
}

// UPDATE LOCAL USER DATA
function updateLocalUser() {
	userName = localStorage.getItem('userName');
	userEmail = localStorage.getItem('userEmail');
	userId = localStorage.getItem('userId');
	userProvider = localStorage.getItem('userProvider');
	userImg = localStorage.getItem('userImg');
}

// APPEND USER DATA TO DISPLAY DIV
function displayUser() {
	let container = getID('user');
	container.innerHTML = '';
	let userImage = document.createElement('img');
		userImage.src = userImg;
		userImage.alt = userName;
	container.appendChild(userImage);
	let userName = document.createElement('h3');
		userName.innerHTML = userName;
	container.appendChild(userName);
	let userEmail = document.createElement('h5');
		userEmail.innerHTML = userEmail;
	container.appendChild(userEmail);
	let userId = document.createElement('span');
		userId.innerHTML = 'Signed in through: ' + userProvider + ' with user id: ' + userId;
	container.appendChild(userId);
}

function hiddenFunctions() {
	if(userId == 21596856 && userName = 'Gunnar Ahlbom') getID('adminButton').disabled = false;
	else {getID('adminButton').disabled = true;
}


</script>
</body>
</html>